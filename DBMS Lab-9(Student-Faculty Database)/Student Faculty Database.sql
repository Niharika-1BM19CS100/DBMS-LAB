CREATE DATABASE STUDENT_FACULTY;
USE STUDENT_FACULTY;
CREATE TABLE STUDENT(
SNUM INT,
SNAME VARCHAR(10),
MAJOR VARCHAR(2),
LVL VARCHAR(2),
AGE INT, PRIMARY KEY(SNUM));

CREATE TABLE FACULTY(
FID INT,FNAME VARCHAR(20),
DEPTID INT,
 PRIMARY KEY(FID));

CREATE TABLE CLASS(
CNAME VARCHAR(20),
METTS_AT TIMESTAMP,
ROOM VARCHAR(10),
 FID INT,
PRIMARY KEY(CNAME),
FOREIGN KEY(FID) REFERENCES FACULTY(FID));

CREATE TABLE ENROLLED(
SNUM INT,
CNAME VARCHAR(20),
PRIMARY KEY(SNUM,CNAME),
FOREIGN KEY(SNUM) REFERENCES STUDENT(SNUM),
FOREIGN KEY(CNAME) REFERENCES CLASS(CNAME));

INSERT INTO STUDENT VALUES(1, 'JHON', 'CS', 'SR', 19);
INSERT INTO STUDENT VALUES(2, 'SMITH', 'CS', 'JR', 20);
INSERT INTO STUDENT VALUES(3 , 'JACOB', 'CV', 'SR', 20);
INSERT INTO STUDENT VALUES(4, 'TOM ', 'CS', 'JR', 20);
INSERT INTO STUDENT VALUES(5, 'RAHUL', 'CS', 'JR', 20);
INSERT INTO STUDENT VALUES(6, 'RITA', 'CS', 'SR', 21);
SELECT * FROM STUDENT; 
INSERT INTO FACULTY VALUES(11, 'HARISH', 1000);
INSERT INTO FACULTY VALUES(12, 'MV', 1000);
INSERT INTO FACULTY VALUES(13 , 'MIRA', 1001);
INSERT INTO FACULTY VALUES(14, 'SHIVA', 1002);
INSERT INTO FACULTY VALUES(15, 'NUPUR', 1000);
SELECT * FROM FACULTY;
INSERT INTO CLASS VALUES('CLASS1', '12/11/15 10:15:16', 'R1', 14);
INSERT INTO CLASS VALUES('CLASS10', '12/11/15 10:15:16', 'R128', 14);
INSERT INTO CLASS VALUES('CLASS2', '12/11/15 10:15:20', 'R2', 12);
INSERT INTO CLASS VALUES('CLASS3', '12/11/15 10:15:25', 'R3', 11);
INSERT INTO CLASS VALUES('CLASS4', '12/11/15 20:15:20', 'R4', 14);
INSERT INTO CLASS VALUES('CLASS5', '12/11/15 20:15:20', 'R3', 15);
INSERT INTO CLASS VALUES('CLASS6', '12/11/15 13:20:20', 'R2', 14);
INSERT INTO CLASS VALUES('CLASS7', '12/11/15 10:10:10', 'R3', 14);
SELECT * FROM CLASS;
INSERT INTO ENROLLED VALUES(1, 'CLASS1');
INSERT INTO ENROLLED VALUES(2, 'CLASS1');
INSERT INTO ENROLLED VALUES(3, 'CLASS3');
INSERT INTO ENROLLED VALUES(4, 'CLASS3');
INSERT INTO ENROLLED VALUES(5, 'CLASS4');
INSERT INTO ENROLLED VALUES(1, 'CLASS5');
INSERT INTO ENROLLED VALUES(2, 'CLASS5');
INSERT INTO ENROLLED VALUES(3, 'CLASS5');
INSERT INTO ENROLLED VALUES(4, 'CLASS5');
INSERT INTO ENROLLED VALUES(5, 'CLASS5');
SELECT * FROM ENROLLED;
-- QUERY 1
SELECT DISTINCT S.SNAME
FROM STUDENT S, CLASS C, ENROLLED E, FACULTY F
WHERE S.SNUM = E.SNUM AND E.CNAME = C.CNAME AND C.FID = F.FID AND
F.FNAME = 'HARISH' AND S.LVL = 'JR';
-- QUERY 2
SELECT DISTINCT CNAME
FROM CLASS
WHERE ROOM='ROOM128'
OR
CNAME IN (SELECT E.CNAME FROM ENROLLED E GROUP BY E.CNAME HAVING COUNT(*)>=5);
-- QUERY 3
SELECT DISTINCT S.SNAME
FROM STUDENT S
WHERE S.SNUM IN (SELECT E1.SNUM
FROM ENROLLED E1, ENROLLED E2, CLASS C1, CLASS C2
WHERE E1.SNUM = E2.SNUM AND E1.CNAME <> E2.CNAME
AND E1.CNAME = C1.CNAME
AND E2.CNAME = C2.CNAME AND C1.METTS_AT = C2.METTS_AT);
-- QUERY 4
SELECT F.FNAME,F.FID
FROM FACULTY F
WHERE F.FID IN ( SELECT FID FROM CLASS
GROUP BY FID HAVING COUNT(*)=(SELECT COUNT(DISTINCT ROOM) FROM CLASS) );
-- QUERY 5
SELECT DISTINCT F.FNAME
FROM FACULTY F
WHERE 5 > (SELECT COUNT(E.SNUM)
FROM CLASS C, ENROLLED E
WHERE C.CNAME = E.CNAME
AND C.FID = F.FID);
-- QUERY 6
SELECT DISTINCT S.SNAME
FROM STUDENT S
WHERE S.SNUM NOT IN (SELECT E.SNUM
FROM ENROLLED E );
-- QUERY 7
SELECT S.AGE, S.LVL
FROM STUDENT S
GROUP BY S.AGE, S.LVL
HAVING S.LVL IN (SELECT S1.LVL
FROM STUDENT S1
WHERE S1.AGE=S.AGE
GROUP BY S1.AGE, S1.LVL
HAVING COUNT(*) >= ALL (SELECT COUNT(*)
FROM STUDENT S2
WHERE S1.AGE=S2.AGE
GROUP BY S2.LVL, S2.AGE))
ORDER BY S.AGE;
